# 辰序 (Chronos) 技术架构图

## 一、表现层 (Presentation Layer)

```mermaid
graph TB
    subgraph "表现层 Presentation Layer"
        direction TB
        Main[主页面 Main.ets<br/>底部导航栏]
        Calendar[日历页面 Calendar.ets]
        Tasks[任务页面 Tasks.ets]
        Accounting[记账页面 Accounting.ets]
        Statistics[统计页面 Statistics.ets]
        Settings[设置页面 Settings.ets]
        
        CalendarComp[日历组件<br/>CalendarComponent]
        TaskItem[任务项组件<br/>TaskItem]
        BillItem[账单项组件<br/>BillItem]
        StatisticsChart[统计图表组件<br/>StatisticsChart]
    end
    
    Main --> Calendar
    Main --> Tasks
    Main --> Accounting
    Main --> Statistics
    Main --> Settings
    
    Calendar --> CalendarComp
    Tasks --> TaskItem
    Accounting --> BillItem
    Statistics --> StatisticsChart
    
    %% 样式定义
    classDef presentation fill:#FF6B35,stroke:#E55A2B,stroke-width:3px,color:#fff
    
    class Main,Calendar,Tasks,Accounting,Statistics,Settings,CalendarComp,TaskItem,BillItem,StatisticsChart presentation
```

**技术栈**：ArkUI 声明式UI框架  
**职责**：页面展示、用户交互、UI组件  
**特点**：使用 `@State`、`@Prop`、`@Link` 等装饰器实现响应式数据绑定

---

## 二、业务逻辑层 (Service Layer)

```mermaid
graph TB
    subgraph "业务逻辑层 Service Layer"
        direction TB
        TaskService[TaskService<br/>任务业务逻辑]
        BillService[BillService<br/>账单业务逻辑]
        EventService[EventService<br/>日程业务逻辑]
        AIService[AIService<br/>AI智能识别]
        MimoAIService[MimoAIService<br/>MIMO大模型API]
        SyncService[SyncService<br/>数据同步服务]
        AuthService[AuthService<br/>认证服务]
        UserService[UserService<br/>用户服务]
    end
    
    AIService --> MimoAIService
    TaskService --> SyncService
    BillService --> SyncService
    EventService --> SyncService
    
    %% 样式定义
    classDef service fill:#FF8C5A,stroke:#FF6B35,stroke-width:3px,color:#fff
    
    class TaskService,BillService,EventService,AIService,MimoAIService,SyncService,AuthService,UserService service
```

**技术栈**：ArkTS  
**职责**：封装业务逻辑，提供统一的服务接口  
**特点**：单例模式，职责分离，易于测试和维护

---

## 三、数据访问层 (Data Access Layer)

```mermaid
graph TB
    subgraph "数据访问层 Data Access Layer"
        direction TB
        LocalDBService[LocalDBService<br/>本地数据库操作]
        CloudDBService[CloudDBService<br/>云端数据库操作]
        DatabaseService[DatabaseService<br/>数据库服务封装]
    end
    
    DatabaseService --> LocalDBService
    DatabaseService --> CloudDBService
    
    %% 样式定义
    classDef dataAccess fill:#4A90E2,stroke:#357ABD,stroke-width:3px,color:#fff
    
    class LocalDBService,CloudDBService,DatabaseService dataAccess
```

**技术栈**：HarmonyOS Data Kit  
**职责**：数据库CRUD操作，数据同步管理  
**特点**：封装数据库操作细节，提供统一的数据访问接口

---

## 四、数据存储层 (Storage Layer)

```mermaid
graph TB
    subgraph "数据存储层 Storage Layer"
        direction TB
        LocalDB[(RelationalStore<br/>本地关系型数据库<br/>SQLite)]
        CloudDB[(Cloud DB<br/>华为云分布式数据库)]
    end
    
    %% 样式定义
    classDef storage fill:#50C878,stroke:#3FA568,stroke-width:3px,color:#fff
    
    class LocalDB,CloudDB storage
```

**技术栈**：
- RelationalStore（本地关系型数据库）
- Cloud DB（华为云分布式数据库）

**职责**：数据持久化存储  
**特点**：离线优先，双数据库架构，自动同步

---

## 五、层间关系图 (Layer Relationships)

```mermaid
graph TB
    subgraph "表现层 Presentation Layer"
        Pages[页面 Pages]
        Components[组件 Components]
    end
    
    subgraph "业务逻辑层 Service Layer"
        TaskService[TaskService]
        BillService[BillService]
        EventService[EventService]
        AIService[AIService]
        SyncService[SyncService]
    end
    
    subgraph "数据访问层 Data Access Layer"
        LocalDBService[LocalDBService]
        CloudDBService[CloudDBService]
    end
    
    subgraph "数据存储层 Storage Layer"
        LocalDB[(RelationalStore<br/>本地SQLite)]
        CloudDB[(Cloud DB<br/>华为云)]
    end
    
    subgraph "外部服务 External Services"
        MimoAPI[MIMO AI API]
        HuaweiCloud[华为云服务]
    end
    
    %% 表现层到业务逻辑层
    Pages --> TaskService
    Pages --> BillService
    Pages --> EventService
    Pages --> AIService
    Components --> TaskService
    Components --> BillService
    
    %% 业务逻辑层内部
    AIService --> MimoAPI
    TaskService --> SyncService
    BillService --> SyncService
    EventService --> SyncService
    
    %% 业务逻辑层到数据访问层
    TaskService --> LocalDBService
    BillService --> LocalDBService
    EventService --> LocalDBService
    SyncService --> CloudDBService
    
    %% 数据访问层到数据存储层
    LocalDBService --> LocalDB
    CloudDBService --> CloudDB
    
    %% 数据访问层到外部服务
    CloudDBService --> HuaweiCloud
    
    %% 样式定义
    classDef layer1 fill:#FF6B35,stroke:#E55A2B,stroke-width:3px,color:#fff
    classDef layer2 fill:#FF8C5A,stroke:#FF6B35,stroke-width:3px,color:#fff
    classDef layer3 fill:#4A90E2,stroke:#357ABD,stroke-width:3px,color:#fff
    classDef layer4 fill:#50C878,stroke:#3FA568,stroke-width:3px,color:#fff
    classDef external fill:#9B59B6,stroke:#8E44AD,stroke-width:3px,color:#fff
    
    class Pages,Components layer1
    class TaskService,BillService,EventService,AIService,SyncService layer2
    class LocalDBService,CloudDBService layer3
    class LocalDB,CloudDB layer4
    class MimoAPI,HuaweiCloud external
```

---

## 数据流向说明

### 写入流程（离线优先）
```
用户操作 → 表现层 → 业务逻辑层 → 数据访问层 → 本地数据库（立即返回）
                                                    ↓
                                            后台异步同步 → 云端数据库
```

### 读取流程
```
用户请求 → 表现层 → 业务逻辑层 → 数据访问层 → 本地数据库（优先）
                                                    ↓
                                            需要时同步 → 云端数据库
```

---

## 技术特点

1. **MVVM模式**：视图与业务逻辑分离，数据驱动UI更新
2. **离线优先**：核心功能完全离线可用，数据优先存入本地
3. **双数据库架构**：本地SQLite + 云端Cloud DB，保证数据安全
4. **响应式设计**：使用ArkUI装饰器实现自动UI更新
5. **组件化开发**：可复用组件，代码结构清晰
6. **分层清晰**：职责分离，易于维护和扩展

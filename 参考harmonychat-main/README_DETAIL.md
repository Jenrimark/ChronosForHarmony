<div align="center">
    <a href="http://www.52im.net/thread-52-1-1.html">
    <img src="entry/src/main/resources/base/media/ic_splash_graybg2.png" width="150" alt="harmonychat logo">
    </a>

  [![star](https://gitcode.com/hellojackjiang2011/harmonychat/star/badge.svg)](https://gitcode.com/hellojackjiang2011/harmonychat)
  [![Gitee star](https://gitee.com/jackjiang/harmonychat/badge/star.svg?theme=white)](https://gitee.com/jackjiang/harmonychat)
  [![GitHub stars](https://img.shields.io/github/stars/JackJiang2011/harmonychat.svg?style=social&label=Stars)](https://github.com/JackJiang2011/harmonychat)
 [![License](https://img.shields.io/badge/license-Apache2.0-00c800)](https://gitee.com/JackJiang2011/MobileIMSDK/blob/master/LICENSE)

<img src="https://trendshift.io/api/badge/repositories/2" alt="MobileIMSDK | Trendshift" style="width: 250px; height: 55px;" width="250" height="55"/>

:heart: <b>æœ€æ–°åŠ¨æ€ï¼š</b>åŸºäºMobileIMSDKçš„é¸¿è’™Nextç«¯IMäº§å“[RainbowTalk](http://www.52im.net/thread-4822-1-1.html)å·²å‘å¸ƒã€‚:heart:

</div>

# ä¸€ã€HarmonyChatæ˜¯ä»€ä¹ˆï¼Ÿ

HarmonyChatæ˜¯ **ä¸€ä¸ªç®€æ´çš„é¸¿è’™NEXTä¸Šçš„åŸºäºWebSocketåè®®çš„èŠå¤©å®¢æˆ·ç«¯** ï¼Œå®ƒåŸºäº[MobileIMSDK](https://gitee.com/jackjiang/MobileIMSDK)ï¼ˆ![star](https://gitcode.com/hellojackjiang2011/MobileIMSDK/star/badge.svg)
![Gitee star](https://gitee.com/jackjiang/MobileIMSDK/badge/star.svg?theme=white)
![GitHub stars](https://img.shields.io/github/stars/JackJiang2011/MobileIMSDK.svg?style=social&label=Stars)ï¼‰é€šä¿¡åº“ï¼Œ **æœ‰å®Œå–„çš„ç½‘ç»œé€šä¿¡é€šåŠ›ã€ç®€æ´çš„èŠå¤©ç•Œé¢UIã€åˆç†çš„ä»£ç æ‹†åˆ†å’Œé€»è¾‘å®ç°ï¼Œéå¸¸é€‚åˆå­¦ä¹ ç ”ç©¶æˆ–ç›´æ¥ç”¨äºç®€å•çš„é¸¿è’™NEXTå•é¡µèŠå¤©é¡¹ç›®ä¸­** ã€‚

HarmonyChatå¼•ç”¨äº†[MobileIMSDK](https://gitee.com/jackjiang/MobileIMSDK)å¼€æºå³æ—¶é€šè®¯æ¡†æ¶çš„é¸¿è’™NEXTç«¯Demoä»£ç ï¼Œå¹¶å‚è€ƒäº†é¸¿è’™NEXTç«¯IMäº§å“[RainbowTalk](http://www.52im.net/thread-4824-1-1.html)çš„éƒ¨åˆ†æ¡†æ¶æ€§ä»£ç ï¼Œå¸Œæœ›èƒ½å¸¦ç»™ä½ å¸®åŠ©ã€‚

![è¾“å…¥å›¾ç‰‡è¯´æ˜](screenshots/all_futures.jpg)

# äºŒã€ä¸ºä»€ä¹ˆæœ‰HarmonyChatï¼Ÿ

æˆ‘æœ¬èº«æ˜¯[MobileIMSDK](https://gitee.com/jackjiang/MobileIMSDK)å¼€æºæ¡†æ¶çš„ä½œè€…ï¼Œæ­£å¥½è¿‘æœŸè¶ç€å¼€å‘MobileIMSDKçš„é¸¿è’™NEXTç«¯æ¼”ç¤ºç•Œé¢çš„æœºä¼šï¼ŒæŠŠç›¸å…³çš„UIä»£ç æ•´ç†å‡ºæ¥ï¼Œå¸Œæœ›åœ¨å½“å‰é¸¿è’™æœ‰è´¨é‡çš„èµ„æ–™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œèƒ½å¸¦ç»™éœ€è¦çš„äººä¸€ç‚¹å¯å‘æˆ–å¸®åŠ©ã€‚

ä½ å¦‚æœåœ¨HarmonyChatä¸­çœ‹åˆ°æœ‰å…³MobileIMSDKçš„èµ„æ–™å’Œå­—çœ¼ä¹Ÿä¸è¦å¥‡æ€ªï¼Œå› ä¸ºæœ¬å·¥ç¨‹ä¸­çš„ä»£ç ã€èµ„æ–™ã€æƒ³æ³•ï¼Œéƒ½æ˜¯ä»[MobileIMSDKçš„é¸¿è’™NEXTç«¯å·¥ç¨‹](https://gitee.com/jackjiang/MobileIMSDK/tree/master/demo_src/WebSocket)ä¸­æ•´ç†å’ŒæŠ½å–å‡ºæ¥çš„ï¼Œç›®çš„æ˜¯æ–¹ä¾¿éœ€è¦çš„äººä»å•ç‹¬çš„UIç•Œé¢å’ŒåŠŸèƒ½æ¥å­¦ä¹ å’Œä½¿ç”¨ã€‚

# ä¸‰ã€è°éœ€è¦HarmonyChatï¼Ÿ

ç›®å‰é«˜è´¨é‡çš„é¸¿è’™NEXTç«¯IMèŠå¤©æ–¹é¢çš„å¼€æºä»£ç è¿˜éå¸¸å°‘ï¼ˆå‡ ä¹æ‰¾ä¸åˆ°æœ‰ä»·å€¼çš„å¼€æºåˆ†äº«ï¼‰ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›èƒ½æŠŠè‡ªå·²ç¼–å†™çš„ç›¸å…³ä»£ç æŠ½å–å‡ºæ¥ä¾›éœ€è¦çš„äººå€Ÿé‰´å’Œä½¿ç”¨ï¼Œå…±åŒè¿›æ­¥ã€‚

<b>HarmonyChatç‰¹åˆ«é€‚åˆä»¥ä¸‹å¼€å‘è€…å­¦ä¹ ã€ç ”ç©¶æˆ–ç›´æ¥ä½¿ç”¨</b>ï¼š

1. :triangular_flag_on_post: æƒ³å­¦ä¹ ä½¿ç”¨ArkTSå’ŒArkUIå¼€å‘èŠå¤©ç•Œé¢çš„ï¼›
2. :triangular_flag_on_post: æƒ³å­¦ä¹ å¦‚æœåœ¨é¸¿è’™NEXTä¸­å¯¹æ¥ç½‘ç»œé€šä¿¡ä»£ç çš„ï¼›
3. :triangular_flag_on_post: æƒ³å­¦ä¹ IMèŠå¤©ç¨‹åºå¦‚ä½•åœ¨é¸¿è’™NEXTä¸­å®ç°UIå’Œç½‘ç»œæ•°æ®çš„é€»è¾‘åˆ†ç¦»çš„ï¼›
4. :triangular_flag_on_post: æƒ³å¾—åˆ°å¯ä»¥ç›´æ¥ä½¿ç”¨çš„å•é¡µèŠå¤©ç•Œé¢çš„ï¼›
5. :triangular_flag_on_post: æƒ³è¦å¼€å‘IMèŠå¤©åº”ç”¨ï¼Œä½†éœ€è¦ä¸€ä¸ªè„šæ‰‹æ¶ä½œä¸ºèµ·ç‚¹çš„ã€‚

# å››ã€å®ç°äº†å“ªäº›ç‰¹æ€§ï¼Ÿ

1. :triangular_flag_on_post: å®ç°äº†ä¸€ä¸ªUIç®€æ´ã€ä»£ç æ¸…æ™°ã€é€»è¾‘åˆ†å±‚åˆç†çš„èŠå¤©ç•Œé¢ï¼ˆå¯ä»¥ç›´æ¥å¤åˆ¶åˆ°ä¸€äº›å•é¡µèŠå¤©äº§ä¸­å“ç”¨ï¼Œæ¯”å¦‚å®¢æœèŠå¤©ï¼‰ï¼›
2. :triangular_flag_on_post: æ¶ˆæ¯çš„é€è¾¾çŠ¶æ€åœ¨UIç•Œé¢ä¸Šä¼šè‡ªåŠ¨æ›´æ–°æ˜¾ç¤ºï¼ˆåŒ…æ‹¬å‘é€ä¸­ã€å·²é€è¾¾ã€é€è¾¾å¤±è´¥ï¼‰ï¼›
3. :triangular_flag_on_post: ç½‘ç»œè¿æ¥çŠ¶æ€çš„UIæ˜¾ç¤ºï¼ˆå«å¿ƒè·³å‘¼å¸ç¯æ•ˆæœï¼‰ï¼›
4. :triangular_flag_on_post: å®ç°äº†çœŸæ­£çš„ç½‘ç»œé€šä¿¡å’ŒèŠå¤©ï¼ˆåŒ…æ‹¬å®Œæ•´çš„å¤šç«¯äº’è¸¢ã€ç½‘ç»œå¿ƒè·³ã€æ‰çº¿é‡è¿ã€æ¶ˆæ¯é‡ä¼ ã€æ¶ˆæ¯åº”ç­”ã€æ¶ˆæ¯å»é‡ç­‰ï¼‰ï¼Œè¿™æ˜¯åŸºäºMobileIMSDKé€šä¿¡åº“å®ç°çš„ï¼›
5. :triangular_flag_on_post: å®ç°äº†éšç§æé†’ã€é—ªå±ã€ç™»å½•ç•Œé¢çš„åˆ¤æ–­å’Œè·³è½¬é€»è¾‘ï¼ˆå¯ä»¥ç›´æ¥å¤åˆ¶è¿™å‡ ä¸ªç•Œé¢åˆ°ä½ çš„äº§å“ä¸­å»ç”¨ç”¨ï¼‰
6. :triangular_flag_on_post: é¸¿è’™NEXTçš„Liståˆ—è¡¨åœ¨LazyForEachå¸¦æ¥çš„æ€§èƒ½ä¼˜åŒ–æƒ…å†µä¸‹çš„åŠ¨æ€UIåˆ·æ–°ï¼›
7. :triangular_flag_on_post: åˆ©ç”¨DataSourceå’Œä¸€ä¸ªå…¨å±€æ¶ˆæ¯ç¼“å­˜ç®¡ç†æœºåˆ¶å®ç°ç½‘ç»œæ•°æ®ä¸UIçš„è§£å¶ï¼ˆ<b>è¿™æ˜¯IMæ¶ˆæ¯å’ŒUIè§£å¶çš„å…³é”®</b>ï¼‰ï¼›
8. :triangular_flag_on_post: å®ç°äº†è·Ÿå¾®ä¿¡åŸºæœ¬ä¸€è‡´çš„æ¶ˆæ¯æ—¶é—´è®¡ç®—å’Œæ˜¾ç¤ºé€»è¾‘ï¼ˆäººæ€§åŒ–æ—¶é—´ã€è¶…è¿‡2åˆ†é’Ÿæ‰æ˜¾ç¤ºæ—¶é—´ï¼‰ï¼›
9. :triangular_flag_on_post: åˆç†çš„æ‹†åˆ†äº†ä¸åŒæ¶ˆæ¯ç±»å‹ç»„ä»¶å¼æ‰©å±•çš„å®ç°é€»è¾‘ï¼Œæ–¹ä¾¿æ‰©å±•æ›´å¤šæ¶ˆæ¯ç±»å‹çš„UIæ˜¾ç¤ºï¼›
10. :triangular_flag_on_post: è§£å†³äº†æ¶ˆæ¯æ–‡æœ¬è¶…é•¿å¯¼è‡´Row()ç»„ä»¶è¢«æŒ¤å‡ºå±å¹•å¯è§†åŒºæ˜¾ç¤ºçš„é—®é¢˜ï¼ˆè¿™å¯èƒ½æ˜¯é¸¿è’™çš„bugï¼‰ï¼›
11. :triangular_flag_on_post: ä¸€äº›é¸¿è’™NEXTç®€å•åŠ¨ç”»çš„åº”ç”¨ï¼›
12. :triangular_flag_on_post: é€‚é…å…¨é¢å±ï¼›
13. :triangular_flag_on_post: è¯¦ç»†çš„ä»£ç æ³¨é‡Šï¼Œä¾¿äºå­¦ä¹ ç ”ç©¶ã€‚

# äº”ã€æºç çš„å¼€æºä»“åº“åœ°å€

 **HarmonyChatæºç åœ¨ä»¥ä¸‹æ‰˜ç®¡ä»“åº“éƒ½æ˜¯åŒæ­¥æ›´æ–°ï¼š**

* 1ï¼‰Githubï¼š[https://github.com/JackJiang2011/harmonychat]() ï¼ˆå¯èƒ½éœ€è¦æ¢¯å­ï¼‰
* 2ï¼‰Giteeï¼š[https://gitee.com/jackjiang/harmonychat](https://gitee.com/jackjiang/harmonychat) ï¼ˆå›½å†…ä»“åº“ï¼Œé€Ÿåº¦å¿« :point_left:ï¼‰
* 3ï¼‰Gitcodeï¼š[https://gitcode.com/hellojackjiang2011/harmonychat](https://gitcode.com/hellojackjiang2011/harmonychat)ï¼ˆå›½å†…ä»“åº“ï¼Œé€Ÿåº¦å¿« :point_left:ï¼‰

 **å¼€æºMobileIMSDKçš„æºç æ‰˜ç®¡ä»“åº“ï¼š**

* 1ï¼‰Giteeç äº‘ï¼š[https://gitee.com/jackjiang/MobileIMSDK](https://gitee.com/jackjiang/MobileIMSDK) ![Gitee star](https://gitee.com/jackjiang/MobileIMSDK/badge/star.svg?theme=white) ğŸ”¥
* 2ï¼‰Gitcodeï¼š[https://gitcode.com/hellojackjiang2011/MobileIMSDK](https://gitcode.com/hellojackjiang2011/MobileIMSDK) ![star](https://gitcode.com/hellojackjiang2011/MobileIMSDK/star/badge.svg) ğŸ”¥
* 3ï¼‰Githubï¼š[https://github.com/JackJiang2011/MobileIMSDK](https://github.com/JackJiang2011/MobileIMSDK)) ![GitHub stars](https://img.shields.io/github/stars/JackJiang2011/MobileIMSDK.svg?style=social&label=Stars) ğŸ”¥

# å…­ã€å®é™…è¿è¡Œæˆªå›¾

#### 1ï¼‰Demo çš„ç™»é™†ç•Œé¢è¿è¡Œæˆªå›¾ï¼ˆç‚¹å‡»å¯çœ‹å¤§å›¾ â–¼ï¼‰ï¼š
![è¾“å…¥å›¾ç‰‡è¯´æ˜](screenshots/run1.png)

#### 2ï¼‰Demo çš„ä¸»ç•Œé¢è¿è¡Œæˆªå›¾ï¼ˆç‚¹å‡»å¯çœ‹å¤§å›¾ â–¼ï¼‰ï¼š
![è¾“å…¥å›¾ç‰‡è¯´æ˜](screenshots/run2.png)

#### 3ï¼‰Demo è¿è¡Œçš„åŒæ—¶ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†çš„ log è¾“å‡ºï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰ï¼š
![è¾“å…¥å›¾ç‰‡è¯´æ˜](screenshots/run3.png)

# ä¸ƒã€å®é™…è¿è¡Œè§†é¢‘åŠ¨å›¾

å¾…è¡¥å……ã€‚ã€‚ã€‚

# å…«ã€æŠ€æœ¯è¦ç‚¹1ï¼šå…³äºæœåŠ¡ç«¯çš„éƒ¨ç½²å’Œè¿è¡Œ

HarmonyChatä¸­é»˜è®¤è¿æ¥çš„æ˜¯MobileIMSDKå¼€æºå·¥ç¨‹çš„æµ‹è¯•æœåŠ¡ç«¯ï¼Œå› æ¡ä»¶æœ‰é™ï¼Œå»ºè®®ä½ è‡ªå·²éƒ¨ç½²æœåŠ¡ç«¯ã€‚èµ„æ–™è¯·å‚è€ƒï¼šã€Š[MobileIMSDKå¼€æºæœåŠ¡ç«¯çš„éƒ¨ç½²æŒ‡å—](http://www.52im.net/thread-1272-1-1.html)ã€‹ã€‚

 **ä½ ä¹Ÿå¯ä»¥ç›´æ¥æ‹‰å–MobileIMSDKå¼€æºæœåŠ¡ç«¯çš„æºç è‡ªè¡Œç¼–è¯‘å’Œè¿è¡Œï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š** 
![è¾“å…¥å›¾ç‰‡è¯´æ˜](screenshots/mbserver.png)

  **PSï¼š** MobileIMSDKå¼€æºæœåŠ¡ç«¯çš„æºç å¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰¾åˆ°ï¼š[ç‚¹æ­¤æŸ¥çœ‹](https://gitee.com/jackjiang/MobileIMSDK/tree/master/demo_src/Server/MobileIMSDKServerDemo2) :paperclip:ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ç¼–è¯‘å¥½çš„ç¨‹åºåŒå‡»run.batå°±å¯ä»¥è¿è¡Œï¼ˆ[ç‚¹æ­¤æŸ¥çœ‹](https://gitee.com/jackjiang/MobileIMSDK/tree/master/demo_binary/Server/MobileIMSDKServerDemo_deploy_v6.5b240429) :paperclip:ï¼‰ã€‚

 **å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š** HarmonyChatä¸­å› ä¸ºç”¨åˆ°çš„æ˜¯é¸¿è’™Nextçš„WebSocketåè®®ï¼Œæ‰€ä»¥è¯·ç¡®ä¿MobileIMSDKå¼€æºæœåŠ¡ç«¯çš„WebSocketç«¯å£æ˜¯å¼€å¯çš„å“¦ã€‚

# ä¹ã€æŠ€æœ¯è¦ç‚¹2ï¼šå…³äºæ¶ˆæ¯æ–‡æœ¬è¶…é•¿å¯¼è‡´Row()ç»„ä»¶è¢«æŒ¤å‡ºå±å¹•å¯è§†åŒºçš„é—®é¢˜

 **é—®é¢˜æè¿°ï¼š** è¿™æ˜¯æˆ‘åœ¨ç¼–å†™æ–‡æœ¬èŠå¤©æ¶ˆæ¯ç»„ä»¶çš„è¿‡ç¨‹ä¸­é‡åˆ°çš„ï¼ŒåŸå›¾æˆ‘æ²¡æœ‰æˆªå‡ºæ¥ï¼Œé—®é¢˜å¤§è‡´æ˜¯ä¸‹å›¾è¿™æ ·ï¼ˆè¿™å›¾æ˜¯æˆ‘åœ¨ç½‘ä¸Šæ‰¾çš„ï¼‰ã€‚

![è¾“å…¥å›¾ç‰‡è¯´æ˜](screenshots/overflow.png)

 **é—®é¢˜çš„åŸå› å°±æ˜¯ï¼š** ä¸ºäº†å®ç°èŠå¤©æ¶ˆæ¯æ°”æ³¡ä¸­çš„è¶…é•¿æ–‡æœ¬èƒ½è‡ªé€‚åº”é•¿åº¦å’Œé«˜åº¦ï¼Œæ‰€ä»¥æ˜¯æ— æ³•ä½¿ç”¨layoutWeightå±æ€§çš„ï¼Œè¿™ä¼šå¯¼è‡´Text()æ‰€åœ¨åœ¨Row()çˆ¶ç»„ä»¶ï¼Œæ— æ³•æ­£ç¡®çš„è®¡ç®—è‡ªå·²çš„å®½åº¦ã€‚

 **è§£å†³åŠæ³•ï¼š** å°±æ˜¯ç”¨Flext()æ›¿ä»£Row()ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![è¾“å…¥å›¾ç‰‡è¯´æ˜](screenshots/overflow2.png)

# åã€æŠ€æœ¯è¦ç‚¹3ï¼šå…³äºä»¿å¾®ä¿¡æ¶ˆæ¯æ—¶é—´æ˜¾ç¤ºçš„ä»£ç å®ç°

å¤§å®¶å¹³æ—¶ä½¿ç”¨å¾®ä¿¡æ¯”è¾ƒå¤šï¼Œå®ƒçš„æ¶ˆæ¯æ—¶é—´æ˜¾ç¤ºæ˜¯å¾ˆäººæ€§åŒ–çš„ï¼Œæ‰€ä»¥ç°åœ¨å¼€å‘IMèŠå¤©åº”ç”¨æ—¶ï¼Œè¿™ä¸ªæ¶ˆæ¯æ—¶é—´çš„äººæ€§åŒ–æ˜¾ç¤ºæ˜¯å¿…åšçš„ã€‚

 **ä»¥ä¸‹æ˜¯æœ¬å·¥ç¨‹ä¸­å®ç°çš„æ•ˆæœï¼ˆè·Ÿå¾®ä¿¡å‡ ä¹ä¸€æ ·ï¼‰ï¼š** 
![è¾“å…¥å›¾ç‰‡è¯´æ˜](screenshots/like_wechat_time.jpg)

 **å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸»è¦å®ç°çš„æ˜¯ï¼š** å¯¹æ¶ˆæ¯æ—¶é—´è¿›è¡Œäº†äººæ€§åŒ–å¤„ç†ï¼ˆæ¯”å¦‚æ˜¨å¤©ä¸Šåˆxxã€ä»Šå¤©ä¸‹åˆxxã€æ˜ŸæœŸxç­‰ï¼‰ï¼Œä»¥æœ‰è¶…è¿‡2åˆ†é’Ÿæ‰æ˜¾ç¤ºæ—¶é—´çš„è¿™ç§é€»è¾‘ã€‚

 **å®Œæ•´ä»£ç æ¶‰åŠåˆ°å‡ ä¸ªæ–¹æ³•ï¼Œå…³é”®ä»£ç å¦‚ä¸‹** ï¼ˆå…·ä½“å¤§å®¶å¯ä»¥çœ‹`/entry/src/main/ets/pages/utils/ToolKits.ets`ä¸­çš„ç›¸å…³æ–¹æ³•ï¼‰ï¼š

```TypeScript
  /**
   * ä»¿ç…§å¾®ä¿¡ä¸­çš„æ¶ˆæ¯æ—¶é—´æ˜¾ç¤ºé€»è¾‘ï¼Œå°†æ—¶é—´æˆ³ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰è½¬æ¢ä¸ºå‹å¥½çš„æ˜¾ç¤ºæ ¼å¼.
   *
   * 1ï¼‰7å¤©ä¹‹å†…çš„æ—¥æœŸæ˜¾ç¤ºé€»è¾‘æ˜¯ï¼šä»Šå¤©ã€æ˜¨å¤©(-1d)ã€å‰å¤©(-2d)ã€æ˜ŸæœŸï¼Ÿï¼ˆåªæ˜¾ç¤ºæ€»è®¡7å¤©ä¹‹å†…çš„æ˜ŸæœŸæ•°ï¼Œå³<=-4dï¼‰ï¼›
   * 2ï¼‰7å¤©ä¹‹å¤–ï¼ˆå³>7å¤©ï¼‰çš„é€»è¾‘ï¼šç›´æ¥æ˜¾ç¤ºå®Œæ•´æ—¥æœŸæ—¶é—´ã€‚

   * @param timestamp æ—¶é—´æˆ³ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ï¼Œå½¢å¦‚ï¼š1550789954260
   * @param mustIncludeTime trueè¡¨ç¤ºè¾“å‡ºçš„æ ¼å¼é‡Œä¸€å®šä¼šåŒ…å«â€œæ—¶é—´:åˆ†é’Ÿâ€
   * ï¼Œå¦åˆ™ä¸åŒ…å«ï¼ˆå‚è€ƒå¾®ä¿¡ï¼Œä¸åŒ…å«æ—¶åˆ†çš„æƒ…å†µï¼Œç”¨äºé¦–é¡µâ€œæ¶ˆæ¯â€ä¸­æ˜¾ç¤ºæ—¶ï¼‰
   * @param timeWithSegmentStr æœ¬å‚æ•°ä»…åœ¨mustIncludeTime=trueæ—¶æœ‰ç”Ÿæ•ˆï¼Œè¡¨ç¤ºåœ¨æ—¶é—´å­—ç¬¦ä¸²å‰å¸¦ä¸Šâ€œä¸Šåˆâ€ã€â€œä¸‹åˆâ€ã€â€œæ™šä¸Šâ€è¿™æ ·çš„æè¿°
   *
   * @return è¾“å‡ºæ ¼å¼å½¢å¦‚ï¼šâ€œåˆšåˆšâ€ã€â€œ10:30â€ã€â€œæ˜¨å¤© 12:04â€ã€â€œå‰å¤© 20:51â€ã€â€œæ˜ŸæœŸäºŒâ€ã€â€œ2019/2/21 12:09â€ç­‰å½¢å¼
   * @author Jack Jiang(http://www.52im.net/thread-2792-1-1.html)
   */
  static getTimeStringAutoShort2(timestamp: number, mustIncludeTime: boolean, timeWithSegmentStr: boolean): string {
    // å½“å‰æ—¶é—´
    let currentDate: Date = new Date();
    // ç›®æ ‡åˆ¤æ–­æ—¶é—´
    let srcDate: Date = new Date(timestamp);

    let currentYear: number = currentDate.getFullYear();
    let currentMonth: number = (currentDate.getMonth()+1);
    let currentDateD: number = currentDate.getDate();

    let srcYear: number = srcDate.getFullYear();
    let srcMonth: number = (srcDate.getMonth()+1);
    let srcDateD: number = srcDate.getDate();

    let ret: string = '';

    // è¦é¢å¤–æ˜¾ç¤ºçš„æ—¶é—´åˆ†é’Ÿ
    let timeExtraStr = '';
    if(mustIncludeTime) {
      // let timeExtraStr = (mustIncludeTime ? " " + _formatDate(srcDate, "hh:mm") : "");
      timeExtraStr = " "+ToolKits.getTimeHH24Human(srcDate, timeWithSegmentStr);
    }

    // å½“å¹´
    if(currentYear === srcYear) {
      let currentTimestamp: number = currentDate.getTime();
      let srcTimestamp: number = timestamp;
      // ç›¸å·®æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰
      let deltaTime: number = (currentTimestamp-srcTimestamp);

      // å½“å¤©ï¼ˆæœˆä»½å’Œæ—¥æœŸä¸€è‡´æ‰æ˜¯ï¼‰
      if(currentMonth === srcMonth && currentDateD === srcDateD) {
        // // æ—¶é—´ç›¸å·®60ç§’ä»¥å†…
        // if(deltaTime < 60 * 1000)
        //     ret = "åˆšåˆš";
        // // å¦åˆ™å½“å¤©å…¶å®ƒæ—¶é—´æ®µçš„ï¼Œç›´æ¥æ˜¾ç¤ºâ€œæ—¶:åˆ†â€çš„å½¢å¼
        // else
        //     ret = _formatDate(srcDate, "hh:mm");

        // å½“å¤©åªéœ€è¦æ˜¾ç¤ºæ—¶é—´åˆ†é’Ÿï¼Œä¸”å¿…é¡»æ˜¾ç¤ºâ€œä¸Šåˆâ€ã€â€œä¸‹åˆâ€è¿™æ ·çš„æ—¶é—´æ®µæè¿°
        ret = ToolKits.getTimeHH24Human(srcDate, true);
      }
      // å½“å¹´ && å½“å¤©ä¹‹å¤–çš„æ—¶é—´ï¼ˆå³æ˜¨å¤©åŠä»¥å‰çš„æ—¶é—´ï¼‰
      else {
        // æ˜¨å¤©ï¼ˆä»¥â€œç°åœ¨â€çš„æ—¶å€™ä¸ºåŸºå‡†-1å¤©ï¼‰
        let yesterdayDate:Date = new Date();
        yesterdayDate.setDate(yesterdayDate.getDate()-1);

        // å‰å¤©ï¼ˆä»¥â€œç°åœ¨â€çš„æ—¶å€™ä¸ºåŸºå‡†-2å¤©ï¼‰
        let beforeYesterdayDate: Date = new Date();
        beforeYesterdayDate.setDate(beforeYesterdayDate.getDate()-2);

        // ç”¨ç›®æ ‡æ—¥æœŸçš„â€œæœˆâ€å’Œâ€œå¤©â€è·Ÿä¸Šæ–¹è®¡ç®—å‡ºæ¥çš„â€œæ˜¨å¤©â€è¿›è¡Œæ¯”è¾ƒï¼Œæ˜¯æœ€ä¸ºå‡†ç¡®çš„ï¼ˆå¦‚æœç”¨æ—¶é—´æˆ³å·®å€¼
        // çš„å½¢å¼ï¼Œæ˜¯ä¸å‡†ç¡®çš„ï¼Œæ¯”å¦‚ï¼šç°åœ¨æ—¶åˆ»æ˜¯2019å¹´02æœˆ22æ—¥1:00ã€è€ŒsrcDateæ˜¯2019å¹´02æœˆ21æ—¥23:00ï¼Œ
        // è¿™ä¸¤è€…é—´åªç›¸å·®2å°æ—¶ï¼Œç›´æ¥ç”¨â€œdeltaTime/(3600 * 1000)â€ > 24å°æ—¶æ¥åˆ¤æ–­æ˜¯å¦æ˜¨å¤©ï¼Œå°±å®Œå…¨æ˜¯æ‰¯è›‹çš„é€»è¾‘äº†ï¼‰
        if(srcMonth === (yesterdayDate.getMonth()+1) && srcDateD === yesterdayDate.getDate()) {
          ret = "æ˜¨å¤©"+timeExtraStr;// -1d
        }
        // â€œå‰å¤©â€åˆ¤æ–­é€»è¾‘åŒä¸Š
        else if(srcMonth === (beforeYesterdayDate.getMonth()+1) && srcDateD === beforeYesterdayDate.getDate()) {
          ret = "å‰å¤©" + timeExtraStr; // -2d
        } else{
          // è·Ÿå½“å‰æ—¶é—´ç›¸å·®çš„å°æ—¶æ•°
          let deltaHour: number = (deltaTime/(3600 * 1000));

          // å¦‚æœå°äºæˆ–ç­‰ 7*24å°æ—¶å°±æ˜¾ç¤ºæ˜ŸæœŸå‡ 
          if (deltaHour <= 7*24){
            let weekday = new Array<string>(7);
            weekday[0]="æ˜ŸæœŸæ—¥";
            weekday[1]="æ˜ŸæœŸä¸€";
            weekday[2]="æ˜ŸæœŸäºŒ";
            weekday[3]="æ˜ŸæœŸä¸‰";
            weekday[4]="æ˜ŸæœŸå››";
            weekday[5]="æ˜ŸæœŸäº”";
            weekday[6]="æ˜ŸæœŸå…­";

            // å–å‡ºå½“å‰æ˜¯æ˜ŸæœŸå‡ 
            let weedayDesc: string = weekday[srcDate.getDay()];
            ret = weedayDesc + timeExtraStr;
          }
          // å¦åˆ™ç›´æ¥æ˜¾ç¤ºå®Œæ•´æ—¥æœŸæ—¶é—´
          else
            ret = ToolKits.formatDate(srcDate, "Mæœˆdæ—¥")+timeExtraStr;
        }
      }
    }
    // å¾€å¹´
    else{
      ret = ToolKits.formatDate(srcDate, "yyå¹´Mæœˆdæ—¥")+timeExtraStr;
    }

    return ret;
  }
```

# åä¸€ã€æŠ€æœ¯è¦ç‚¹4ï¼šå…³äºç½‘ç»œæ•°æ®ä¸UIç•Œé¢è§£å¶çš„å®ç°

åœ¨IMèŠå¤©åº”ç”¨ä¸­ï¼Œç½‘ç»œæ•°æ®ä¸UIç•Œé¢è§£å¶æ˜¯éå¸¸å…³é”®çš„ï¼Œå¦åˆ™ç½‘ç»œä»£ç çš„å¤æ‚æ€§è·Ÿåº”ç”¨å±‚é€»è¾‘çš„å¤æ‚æ€§åˆå¹¶åœ¨ä¸€èµ·ï¼Œé‚£ä»£ç ä¼šè¶Šå†™è¶Šå›°éš¾ã€‚

HarmonyChatä¸­ä¸»è¦æ˜¯å€ŸåŠ©äº†ä¸€ä¸ªå…¨å±€çš„æ¶ˆæ¯æ•°æ®ç®¡ç†å™¨å’ŒIDataSourceï¼Œå®ç°äº†ä¸èŠå¤©åˆ—è¡¨UIç•Œé¢çš„è§£å¶ã€‚

 **å…¨å±€çš„æ¶ˆæ¯æ•°æ®ç®¡ç†å™¨ä»£ç å®ç°** ï¼ˆè¯¦è§`/entry/src/main/ets/pages/utils/MessagesProvider.ets`ï¼‰ï¼š

```TypeScript
/**
 * èŠå¤©æ¶ˆæ¯çš„ç¼“å­˜æ•°æ®ç®¡ç†æä¾›è€…ï¼ˆé›†ä¸­ç®¡ç†æ‰€æœ‰çš„èŠå¤©æ¶ˆæ¯å’ŒæŒ‡ä»¤ï¼Œæ¶ˆæ¯æ¥æºä¸ºç½‘ç»œå±‚é€šä¿¡æ•°æ®åŒ…å’Œæœ¬åœ°å‘å‡ºçš„åŒ…
 * ï¼Œæ¶ˆæ¯æ˜¾ç¤ºæ–¹å¼é€šè¿‡MessagesDataSourceä¸UIç•Œé¢è¿›è¡Œè§£å¶æ˜¾ç¤ºï¼‰ã€‚
 *
 * ä»£ç å‚è€ƒè‡ªIMäº§å“RainbowChatï¼šhttp://www.52im.net/thread-19-1-1.html
 *
 * @author Jack Jiang(http://www.52im.net/thread-2792-1-1.html)
 */
export default class MessagesProvider {

  /** èŠå¤©ç•Œé¢ä¸­ï¼Œæ¶ˆæ¯çš„æ˜¾ç¤ºæ—¶é—´é—´éš”ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ï¼šé»˜è®¤æ˜¯2åˆ†é’Ÿå†…çš„æ¶ˆæ¯åªåœ¨ç¬¬ä¸€æ¡æ¶ˆæ¯ä¸Šæ˜¾ç¤ºæ—¶é—´ï¼Œå¦åˆ™ä¼šå†æ¬¡æ˜¾ç¤ºæ—¶é—´ */
  // å‚è€ƒèµ„æ–™ï¼šhttp://www.52im.net/thread-3008-1-1.html#40
  private static readonly CHATTING_MESSAGE_SHOW_TIME_INTERVAL: number = 2 * 60 * 1000;

  /** çœŸæ­£çš„èŠå¤©è½¯ä»¶ä¸­ï¼Œæ­¤å¤„åº”æ”¹é€ ä¸º<key=uid, value=Array<Message> >è¿™æ ·çš„Mapé›†åˆï¼Œç”¨äºæŒ‰uidåˆ†åˆ«å­˜å‚¨ä¸å„å¥½å‹çš„èŠå¤©æ¶ˆæ¯ */
  private messages: Array<Message> = [];

  /**
   * åŠ å…¥ä¸€æ¡æ–°æ¶ˆæ¯ã€‚
   *
   * @param m æ¶ˆæ¯å¯¹è±¡
   */
  putMessage(m: Message): void {
    // ä»¥ä¸‹ä»£ç ç”¨äºåˆ¤æ–­å¹¶å®ç°ä»¿å¾®ä¿¡çš„åªæ˜¾ç¤º2åˆ†é’Ÿå†…èŠå¤©æ¶ˆæ¯çš„æ—¶é—´æ ‡è¯†ï¼ˆå‚è€ƒèµ„æ–™ï¼šhttp://www.52im.net/thread-3008-1-1.html#40ï¼‰
    let previousMessage: Message | undefined = undefined;
    let messagesSize: number = this.messages.length;
    if (messagesSize > 0) {
      previousMessage = this.messages[messagesSize - 1];
    }
    MessagesProvider.setMessageShowTopTime(m, previousMessage);

    // å°†æ­¤æ–°æ¶ˆæ¯å¯¹è±¡æ”¾å…¥æ•°æ®æ¨¡å‹(åˆ—è¡¨)
    this.messages.push(m);

    // é€šçŸ¥åº”ç”¨å±‚æ›´æ–°ui
    IMClientManager.getInstance().getEmitter().emit(UIEvent.UIEVENT_messageAdded, this.messages.length - 1);
  }

  /**
   * è·å¾—æ¶ˆæ¯æ•°æ®ç¼“å­˜é›†åˆã€‚
   *
   * @returns æ¶ˆæ¯æ•°æ®ç¼“å­˜é›†åˆ
   */
  getMessages(): Array<Message> {
    return this.messages;
  }

  /**
   * æ·»åŠ ä¸€æ¡ç³»ç»Ÿæ¶ˆæ¯ï¼ˆæ˜¾ç¤ºåœ¨èŠå¤©åˆ—è¡¨ä¸­ï¼‰ã€‚
   *
   * @param content æ¶ˆæ¯å†…å®¹
   */
  addSystemMessage(content: string): void {
    let m: Message = Message.createChatMsgEntity_INCOME_SYSTEAMINFO('0', content, 0);
    this.putMessage(m);
  }

  /**
   * æ›´æ–°æŒ‡å®šæŒ‡çº¹ç çš„æ¶ˆæ¯çš„å‘é€çŠ¶æ€ï¼ˆæ›´æ–°å•æ¡æ¶ˆæ¯ï¼‰ã€‚
   *
   * @param fingerPrint æ¶ˆæ¯æŒ‡çº¹ç ï¼ˆæ¶ˆæ¯idï¼‰
   * @param sendStatus å‘é€çŠ¶æ€ï¼Œsee {@link MsgSendStatus}
   */
  updateMessageSendStatus(fingerPrint: string, sendStatus: MsgSendStatus): void {
    // éå†æ¶ˆæ¯åˆ—è¡¨
    for(let i = 0; i < this.messages.length; i++) {
      let m = this.messages[i];
      // å¯¹ç¬¦åˆæ¡ä»¶çš„æ¶ˆæ¯å¯¹è±¡è¿›è¡Œæ¶ˆæ¯å‘é€çŠ¶æ€çš„è®¾ç½®
      if(m && m.isOutgoing() && m.fingerPrintOfProtocal === fingerPrint) {
        // æ›´æ–°çŠ¶æ€
        m.sendStatus = sendStatus;
        // é€šçŸ¥åº”ç”¨å±‚æ›´æ–°uiï¼ˆå‚æ•°å°±æ˜¯æ¶ˆæ¯æ‰€åœ¨ç´¢å¼•ï¼‰
        IMClientManager.getInstance().getEmitter().emit(UIEvent.UIEVENT_messageUpdate, i);
      }
    }
  }

  /**
   * æ›´æ–°æŒ‡å®šæŒ‡çº¹ç çš„æ¶ˆæ¯çš„å‘é€çŠ¶æ€ï¼ˆæ›´æ–°å¤šæ¡æ¶ˆæ¯ï¼‰ã€‚
   * ç›®å‰ç”¨äºQoSé€è¾¾æœºåˆ¶ä¸­å‘Šè¯‰åº”ç”¨å±‚æœ‰å“ªäº›åŸå§‹æ¶ˆæ¯æŠ¥æ–‡æœªæˆåŠŸé€è¾¾ç»™å¯¹æ–¹ã€‚
   *
   * @param  protocals åŸå§‹æ¶ˆæ¯æŠ¥æ–‡å¯¹è±¡æ•°ç»„ï¼Œæ•°ç»„ä¸­Protocalå¯¹è±¡æŒ‡çº¹ç ï¼ˆæ¶ˆæ¯idï¼‰å°±æ˜¯æœ¬æ¬¡è¦æ›´æ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ•°ç»„ç›®å‰æ¥è‡ªäºSDKçš„ EventType.onMessagesLost äº‹ä»¶é€šçŸ¥
   * @param sendStatus å‘é€çŠ¶æ€ï¼Œsee {@link MsgSendStatus}
   */
  updateMessagesSendStatus(protocals: Protocal[], sendStatus: MsgSendStatus): void {
    let updateIndexes: number[] = [];

    // éå†æ¶ˆæ¯åˆ—è¡¨
    // this.messages.forEach((m: Message) => {
    for(let mi = 0; mi < this.messages.length; mi++) {
      let m = this.messages[mi];
      for(let i = 0; i < protocals.length; i++){
        let p = protocals[i];
        // å¯¹ç¬¦åˆæ¡ä»¶çš„æ¶ˆæ¯å¯¹è±¡è¿›è¡Œæ¶ˆæ¯å‘é€çŠ¶æ€çš„è®¾ç½®
        if(m && m.isOutgoing() && m.fingerPrintOfProtocal === p.fp) {
          // æ›´æ–°çŠ¶æ€
          m.sendStatus = sendStatus;
          // åŠ å…¥å·²æ›´æ–°ç´¢å¼•åˆ—è¡¨é›†åˆ
          updateIndexes.push(mi);
          break;
        }
      }
    }

    if(updateIndexes.length > 0) {
      // é€šçŸ¥åº”ç”¨å±‚æ›´æ–°uiï¼ˆå‚æ•°å°±æ˜¯æ¶ˆæ¯æ‰€åœ¨ç´¢å¼•ï¼‰
      IMClientManager.getInstance().getEmitter().emit(UIEvent.UIEVENT_messagesUpdate, updateIndexes);
    }
  }

  /**
   * æ¸…ç©ºæ‰€æœ‰æ¶ˆæ¯ã€‚
   */
  clear(): void {
    this.messages = [];
  }

  /**
   * ä¸ºå½“å‰çš„æ¶ˆæ¯å¯¹è±¡ï¼Œè®¾ç½®æ˜¯å¦æ˜¾ç¤ºæ¶ˆæ¯æ—¶é—´æ ‡è¯†ã€‚
   *
   * æ­¤æ—¶é—´æ˜¾ç¤ºé€»è¾‘æ˜¯ä¸å¾®ä¿¡ä¿æŒä¸€è‡´çš„ï¼šå³åªæ˜¾ç¤º5åˆ†é’Ÿå†…èŠå¤©æ¶ˆæ¯çš„æ—¶é—´æ ‡è¯†ï¼Œå‚è€ƒèµ„æ–™ï¼šhttp://www.52im.net/thread-3008-1-1.html#40
   *
   * @param theMessage å½“å‰æ¶ˆæ¯å¯¹è±¡ï¼Œä¸å¯ä¸ºnull
   * @param previousMessage å½“å‰æ¶ˆæ¯çš„è‡ªç„¶æ—¶é—´çš„ä¸Šä¸€æ¡æ¶ˆæ¯ï¼Œæ­¤æ¶ˆæ¯å¯ä¸ºç©ºï¼ˆæ­¤ä¸ºç©ºå³è¡¨ç¤ºå½“å‰æ¶ˆæ¯å°±æ˜¯æ¶ˆæ¯é›†åˆä¸­çš„ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼‰
   */
  private static setMessageShowTopTime(theMessage: Message, previousMessage: Message | undefined): void {
    if(theMessage) {
      if(previousMessage === undefined) {
        theMessage.showTopTime = true;
        return;
      }

      // ä»¥ä¸‹ä»£ç ç”¨äºåˆ¤æ–­å¹¶å®ç°ä»¿å¾®ä¿¡çš„åªæ˜¾ç¤º5åˆ†é’Ÿå†…èŠå¤©æ¶ˆæ¯çš„æ—¶é—´æ ‡è¯†ï¼ˆå‚è€ƒèµ„æ–™ï¼šhttp://www.52im.net/thread-3008-1-1.html#40ï¼‰
      if(theMessage.date - previousMessage.date > MessagesProvider.CHATTING_MESSAGE_SHOW_TIME_INTERVAL)
        theMessage.showTopTime = true;
    }
  }
}
```

 **IDataSourceå®ç°ç±»** ï¼ˆè¯¦è§`/entry/src/main/ets/pages/utils/MessagesDataSource.ets`ï¼‰ï¼š

```TypeScript
/**
 * èŠå¤©ç•Œé¢ï¼ˆChatPage.etsï¼‰ä¸­çš„Liståˆ—è¡¨å¯¹åº”çš„æ•°æ®æºå®ç°ç±»ï¼ˆè´Ÿè´£èŠå¤©æ¶ˆæ¯æ•°æ®çš„UIæ˜¾ç¤ºï¼‰ã€‚
 *
 * æ³¨æ„ï¼šæœ¬ç±»ä¸­çš„æ•°æ®æ¥æºä¸ºå…¨å±€æ¶ˆæ¯ç¼“å­˜ç®¡ç†ç±» MessageProvider ä¸­ç¼“å­˜æ¶ˆæ¯é›†åˆçš„å¯¹è±¡å¼•ç”¨ï¼ˆæµ…æ‹·è´ï¼‰ï¼Œç›¸å½“äºå…±ç”¨åŒä¸€ä¸ªç¼“å­˜ï¼Œæ— éœ€å•
 * ç‹¬ç»´æŠ¤æ•°æ®ï¼Œå®ç°äº†èŠå¤©æ¶ˆæ¯æ•°æ®çš„ç®¡ç†ï¼ˆMessageProviderè´Ÿè´£ï¼‰å’ŒUIç•Œé¢æ˜¾ç¤ºï¼ˆMessagesDataSourceè´Ÿè´£ï¼‰çš„è§£å¶ã€‚
 *
 * @author JackJang
 * @since 1.0
 */
export default class MessagesDataSource extends BasicDataSource<Message> {

  /** å¼•ç”¨å…¨å±€æ¶ˆæ¯ç¼“å­˜ç®¡ç†ç±» MessageProvider ä¸­ç¼“å­˜æ¶ˆæ¯é›†åˆï¼ˆæµ…æ‹·è´ï¼‰*/
  private messages: Array<Message> = IMClientManager.getInstance().getMessageProvider().getMessages();

  notifyDataReload(): void {
    super.notifyDataReload();
  }

  totalCount(): number {
    return this.messages.length
  }

  getData(index: number): Message {
    return this.messages[index]
  }

  /**
   * åœ¨Listä¸­ä½¿ç”¨LazyForEachæ—¶ï¼Œå“åº”å¼uiéœ€è¦keyå˜åŒ–æ‰ä¼šæ›´æ–°ï¼Œæœ¬æ–¹æ³•å°±æ˜¯æŒ‰å¯å˜çš„å†…å®¹è®¡ç®—keyï¼Œä»è€Œåœ¨DataSourceæ›´æ–°æ—¶ï¼Œ
   * èƒ½è®©uiæ„ŸçŸ¥åˆ°ï¼Œä¸ç„¶UIæ˜¯ä¸ä¼šåˆ·æ–°æ˜¾ç¤ºçš„ã€‚
   *
   * @param m æ¶ˆæ¯å¯¹è±¡
   * @returns è®¡ç®—å‡ºçš„key
   */
  static messageItemKey(m: Message) {
    // ä¼˜åŒ–ç‚¹ï¼šç»™æ›´æ–°çš„æ¶ˆæ¯å¯¹è±¡åŠ ä¸ªæœ€è¿‘æ›´æ–°æ—¶é—´æˆ³ï¼Œè¿™åº”è¯¥æ˜¯ä¸ªæ›´é€šç”¨çš„keyè®¡ç®—é¡¹ï¼Œä¸ç„¶ä¸€æ—¦å˜æ›´å†…å®¹å¤šäº†ï¼Œè¿™ä¸ªkeyçš„è®¡ç®—å°±ä¸é‚£ä¹ˆä¼˜é›…äº†
    return m.msgType + '-' + m.fingerPrintOfProtocal + '-' + m.sendStatus;
  }
}
```

# åäºŒã€æŠ€æœ¯è¦ç‚¹5ï¼šå…³äºç½‘ç»œé€šä¿¡å±‚ä¸UIå±‚çš„è”åŠ¨

HarmonyChatä¸­çš„ç½‘ç»œé€šä¿¡å±‚ä¸UIå±‚çš„è”åŠ¨ï¼Œä¸»è¦æ˜¯é€šè¿‡MobileIMSDKé¸¿è’™å®¢æˆ·ç«¯SDKçš„äº‹ä»¶é€šçŸ¥å®ç°çš„è”åŠ¨ï¼Œä»è€Œè§£å†³äº†åº”ç”¨å±‚ä¸é€šä¿¡å±‚çš„ä»£ç è§£å¶ã€‚

 **MobileIMSDKé¸¿è’™å®¢æˆ·ç«¯SDKæä¾›çš„äº‹ä»¶æœ‰ä¸‹é¢è¿™äº›ï¼š** 

```TypeScript
export default class SocketEvent {
    /** ç½‘ç»œäº‹ä»¶ï¼šç™»å½•è¿æ¥æˆ–æ‰çº¿é‡è¿å“åº”åé¦ˆ */
    static readonly SOCKET_EVENT_ON_LOGIN_RESPONSE: string;
    /** ç½‘ç»œäº‹ä»¶ï¼šç½‘ç»œæ–­å¼€(æ‰çº¿äº†) */
    static readonly SOCKET_EVENT_ON_LINK_CLOSE: string;
    /** ç½‘ç»œäº‹ä»¶ï¼šæ”¶åˆ°æ–°çš„æ¶ˆæ¯ */
    static readonly SOCKET_EVENT_ON_RECIEVE_MESSAGE: string;
    /** ç½‘ç»œäº‹ä»¶ï¼šæœåŠ¡ç«¯åé¦ˆçš„é”™è¯¯ä¿¡æ¯ï¼ˆè¿™ç§é”™è¯¯å‡ºç°å³è¡¨ç¤ºè¿æ¥ä¸å¯æ¢å¤ï¼ŒSDKæ¡†æ¶å°†ä¼šè‡ªåŠ¨è¿›å…¥é‡è¿åŠ¨ä½œï¼‰ */
    static readonly SOCKET_EVENT_ON_ERROR_RESPONSE: string;
    /** ç½‘ç»œäº‹ä»¶ï¼šå‘å‡ºçš„æ¶ˆæ¯æ²¡æœ‰æˆåŠŸè¢«é€è¾¾ï¼ˆæ²¡æœ‰æ”¶åˆ°åº”ç­”ç¡®è®¤åŒ…ï¼‰ */
    static readonly SOCKET_EVENT_MESSAGE_LOST: string;
    /** ç½‘ç»œäº‹ä»¶ï¼šå‘å‡ºçš„æ¶ˆæ¯å·²æˆåŠŸè¢«é€è¾¾ï¼ˆæ”¶åˆ°åº”ç­”ç¡®è®¤åŒ…ï¼‰ */
    static readonly SOCKET_EVENT_MESSAGE_BE_RECIEVED: string;
    /** ç½‘ç»œäº‹ä»¶ï¼šæ­£åœ¨å°è¯•æ‰çº¿é‡è¿åŠ¨ä½œ */
    static readonly SOCKET_EVENT_RECONNECT_ATTEMPT: string;
    /** ç½‘ç»œäº‹ä»¶ï¼šå¿ƒè·³åŒ…ï¼ˆå®¢æˆ·ç«¯å‘å‡ºçš„ï¼‰ */
    static readonly SOCKET_EVENT_PING: string;
    /** ç½‘ç»œäº‹ä»¶ï¼šå¿ƒè·³åŒ…ï¼ˆå®¢æˆ·ç«¯æ”¶åˆ°çš„ï¼‰ */
    static readonly SOCKET_EVENT_PONG: string;
    /** ç½‘ç»œäº‹ä»¶ï¼šå®¢æˆ·ç«¯å·²è¢«å¼ºè¡Œè¸¢å‡º */
    static readonly SOCKET_EVENT_KICKOUT: string;
}
```

 **HarmonyChatä¸­é€šè¿‡ç›‘å¬ä»¥ä¸Šäº‹ä»¶å¹¶å¤„ç†åï¼ŒæŠ›ç»™UIåº”ç”¨å±‚çš„äº‹ä»¶å°±éå¸¸ç®€å•äº†ï¼Œæš‚æ—¶ä»…ä»…éœ€è¦ä»¥ä¸‹å‡ ä¸ªäº‹ä»¶å°±å®ç°äº†å½“å‰çš„UIåˆ·æ–°ç­‰ä»»åŠ¡ï¼š** 

```TypeScript
/**
 * åº”ç”¨å±‚çš„å„ç§é€šçŸ¥äº‹ä»¶ç±»å‹ï¼Œè¿™äº›äº‹ä»¶ä¸»è¦ç”¨äºé€šçŸ¥UIç•Œé¢çš„æ›´æ–°ç­‰ã€‚
 *
 * @author Jack Jiang(http://www.52im.net/thread-2792-1-1.html)
 */
export default class UIEvent {
  /** UIäº‹ä»¶ï¼šç™»å½•æˆ–æ‰çº¿é‡è¿å®Œæˆ */
  static readonly UIEVENT_onIMAfterLoginComplete: string = "uievent.onIMAfterLoginComplete";
  /** UIäº‹ä»¶ï¼šæ‰çº¿äº† */
  static readonly UIEVENT_onIMDisconnected: string = "uievent.onIMDisconnected";
  /** UIäº‹ä»¶ï¼šå¿ƒè·³äº†ä¸€æ¬¡ï¼ˆå‘å‡ºçš„ï¼‰ */
  static readonly UIEVENT_onIMPing: string = "uievent.onIMPing";
  /** UIäº‹ä»¶ï¼šå¿ƒè·³äº†ä¸€æ¬¡ï¼ˆæ”¶åˆ°çš„åº”ç­”åŒ…ï¼‰ */
  static readonly UIEVENT_onIMPong: string = "uievent.onIMPong";
  /** UIäº‹ä»¶ï¼šä½ è¢«è¸¢äº† */
  static readonly UIEVENT_onKickout: string = "uievent.onKickout";

  /** UIäº‹ä»¶ï¼šå¢åŠ äº†èŠå¤©æ¶ˆæ¯ */
  static readonly UIEVENT_messageAdded = 'uievent.messageAdded';
  /** UIäº‹ä»¶ï¼šæ›´æ–°äº†èŠå¤©æ¶ˆæ¯ï¼ˆå•æ¡èŠå¤©æ¶ˆæ¯ï¼‰ */
  static readonly UIEVENT_messageUpdate = 'uievent.messageUpdate';
  /** UIäº‹ä»¶ï¼šæ›´æ–°äº†èŠå¤©æ¶ˆæ¯ï¼ˆå¤šæ¡èŠå¤©æ¶ˆæ¯ï¼‰ */
  static readonly UIEVENT_messagesUpdate = 'uievent.messagesUpdate';
}
```

HarmonyChatä¸­æ³¨å†Œå’Œç›‘å¬è¿™äº›äº‹ä»¶çš„å…·ä½“ä»£ç é€»è¾‘ä½äº `/entry/src/main/ets/pages/utils/IMClientManager.ets`ç±»ä¸­ï¼Œä»£ç æœ‰ç‚¹é•¿å°±ä¸è´´äº†ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹ã€‚

# åä¸‰ã€ç›¸å…³èµ„æ–™

* â‘  [é¸¿è’™Nextå®˜æ–¹å¼€å‘èµ„æ–™](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-websocket-V5)
* â‘¡ [MobileIMSDKå¼€æºæ¡†æ¶çš„APIæ–‡æ¡£](http://www.52im.net/topic-docs.html#mobileimsdk)
* â‘¢ [MobileIMSDKå¼€æºIMæ¡†æ¶æºç ](https://gitee.com/jackjiang/MobileIMSDK)ï¼ˆ[Githubåœ°å€ç‚¹æ­¤](https://github.com/JackJiang2011/MobileIMSDK)ï¼‰
* â‘£ [MobileIMSDK-é¸¿è’™Nextç«¯å¼€å‘æ‰‹å†Œ](http://www.52im.net/thread-4767-1-1.html)ï¼ˆ* æ¨èï¼‰
* â‘¤ [MobileIMSDK-æœåŠ¡ç«¯éƒ¨ç½²æ‰‹å†Œ](http://www.52im.net/thread-1272-1-1.html)

# åå››ã€Bugä¸ŠæŠ¥å’ŒæŠ€æœ¯è®¨è®º

* è®¨è®ºå­¦ä¹ å’Œèµ„æ–™æŸ¥é˜…ï¼š[ç‚¹æ­¤è¿›å…¥](http://www.52im.net/)ï¼›
* bugå’Œå»ºè®®è¯·å‘é€è‡³ï¼š`jb2011@163.com`ï¼Œæˆ–è€…åœ¨æœ¬å·¥ç¨‹ä¸­å¼€Issueä¹Ÿè¡Œï¼›
* æ¬¢è¿è”ç³»ä½œè€…QQï¼š`413980957`ã€å¾®ä¿¡ï¼š`hellojackjiang`  ï¼ˆ :point_right: [å…³äºä½œè€…](http://www.52im.net/thread-2792-1-1.html)ï¼‰ã€‚

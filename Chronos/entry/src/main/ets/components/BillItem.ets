import { Bill, BillType, BillCategory } from '../model/Bill';
import { Utils } from '../common/Utils';
import { Constants } from '../common/Constants';

/**
 * è´¦å•é¡¹ç»„ä»¶
 */
@Component
export struct BillItem {
  @Prop bill: Bill = new Bill();
  @Link onTapAction: number;
  @Link onDeleteAction: number;
  
  @State actionId: number = 0;

  aboutToAppear() {
    this.actionId = this.bill.id;
  }

  /**
   * èŽ·å–åˆ†ç±»å›¾æ ‡
   */
  getCategoryIcon(category: BillCategory): string {
    switch (category) {
      case BillCategory.FOOD:
        return 'ðŸ”';
      case BillCategory.TRANSPORT:
        return 'ðŸš—';
      case BillCategory.SHOPPING:
        return 'ðŸ›ï¸';
      case BillCategory.ENTERTAINMENT:
        return 'ðŸŽ¬';
      case BillCategory.MEDICAL:
        return 'ðŸ¥';
      case BillCategory.EDUCATION:
        return 'ðŸ“š';
      case BillCategory.HOUSING:
        return 'ðŸ ';
      case BillCategory.UTILITIES:
        return 'ðŸ’¡';
      case BillCategory.SALARY:
        return 'ðŸ’°';
      case BillCategory.BONUS:
        return 'ðŸŽ';
      case BillCategory.INVESTMENT:
        return 'ðŸ“ˆ';
      case BillCategory.GIFT:
        return 'ðŸŽ';
      default:
        return 'ðŸ“';
    }
  }

  /**
   * èŽ·å–åˆ†ç±»åç§°
   */
  getCategoryName(category: BillCategory): string {
    switch (category) {
      case BillCategory.FOOD:
        return 'é¤é¥®';
      case BillCategory.TRANSPORT:
        return 'äº¤é€š';
      case BillCategory.SHOPPING:
        return 'è´­ç‰©';
      case BillCategory.ENTERTAINMENT:
        return 'å¨±ä¹';
      case BillCategory.MEDICAL:
        return 'åŒ»ç–—';
      case BillCategory.EDUCATION:
        return 'æ•™è‚²';
      case BillCategory.HOUSING:
        return 'ä½æˆ¿';
      case BillCategory.UTILITIES:
        return 'æ°´ç”µ';
      case BillCategory.SALARY:
        return 'å·¥èµ„';
      case BillCategory.BONUS:
        return 'å¥–é‡‘';
      case BillCategory.INVESTMENT:
        return 'æŠ•èµ„';
      case BillCategory.GIFT:
        return 'ç¤¼é‡‘';
      case BillCategory.OTHER_EXPENSE:
        return 'å…¶ä»–æ”¯å‡º';
      case BillCategory.OTHER_INCOME:
        return 'å…¶ä»–æ”¶å…¥';
      default:
        return 'å…¶ä»–';
    }
  }

  build() {
    Row() {
      // åˆ†ç±»å›¾æ ‡
      Text(this.getCategoryIcon(this.bill.category))
        .fontSize(32)
        .width(48)
        .height(48)
        .textAlign(TextAlign.Center)
        .backgroundColor(this.bill.isIncome() ? '#E8F5E9' : '#FFF3E0')
        .borderRadius(24)

      // è´¦å•ä¿¡æ¯
      Column() {
        Row() {
          Text(this.getCategoryName(this.bill.category))
            .fontSize(16)
            .fontColor(Constants.COLOR_TEXT_PRIMARY)
            .fontWeight(FontWeight.Medium)

          Blank()

          Text(this.bill.getDisplayAmount())
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor(
              this.bill.isIncome()
                ? Constants.COLOR_SUCCESS
                : Constants.COLOR_DANGER
            )
        }
        .width('100%')

        if (this.bill.description) {
          Text(this.bill.description)
            .fontSize(14)
            .fontColor(Constants.COLOR_TEXT_SECONDARY)
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .margin({ top: 4 })
        }

        Row() {
          Text(Utils.formatDate(this.bill.date, 'MM-DD HH:mm'))
            .fontSize(12)
            .fontColor(Constants.COLOR_TEXT_SECONDARY)

          if (this.bill.tags && this.bill.tags.length > 0) {
            Text(this.bill.tags.join(' '))
              .fontSize(12)
              .fontColor(Constants.COLOR_PRIMARY)
              .margin({ left: 8 })
          }
        }
        .width('100%')
        .margin({ top: 4 })
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)
      .margin({ left: 12 })

      // åˆ é™¤æŒ‰é’®
      Text('Ã—')
        .width(24)
        .height(24)
        .fontSize(20)
        .fontColor(Constants.COLOR_TEXT_SECONDARY)
        .textAlign(TextAlign.Center)
        .onClick(() => {
          this.onDeleteAction = this.bill.id;
        })
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(8)
    .margin({ bottom: 8 })
    .onClick(() => {
      this.onTapAction = this.bill.id;
    })
  }
}


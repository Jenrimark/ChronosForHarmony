# 云数据库

**更新时间: 2025-12-23 19:44**

* **[新增对象类型](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-add-object)**
* **[新增存储区](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-add-zone)**
* **[引入对象类型文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-add-file)**
* **[初始化数据库访问](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-initialize)**
* **[查询数据](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-query)**
* **[写入数据](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-upsert)**
* **[删除数据](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-delete)**


# 引入对象类型文件

**更新时间: 2025-12-23 19:45**

## 约束与限制

支持Phone、Tablet设备。并且从5.1.0(18)版本开始，新增支持Wearable设备；从5.1.1(19)版本开始，新增支持TV设备。

## 前提条件

* 已[新增对象类型](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-add-object)。
* 已[新增存储区](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-add-zone)。

## 操作步骤

1. 将导出的[json格式文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-add-object#zh-cn_topic_0000001518866308_li0821548919)命名为schema.json，拷贝到DevEco

   Studio项目的“AppScope/resources/rawfile”或者“entry/src/main/resources/rawfile”目录下。在编译构建过程中，AppScope目录下的资源文件会合入到模块的资源文件中，详细信息请参见[资源分类](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/resource-categories-and-access#资源分类)。
2. 按照AGC控制台上创建的对象类型“BookInfo”在代码工程中创建BookInfo.ets文件，文件内容参考以下代码。
   说明

   在AGC控制台创建的字段类型与ArkTS数据类型的匹配关系如下：

   * String、Text对应string。
   * Boolean对应boolean。
   * Byte、ByteArray对应Uint8Array。
   * Short、Integer、Long、Float、Double、IntAutoIncrement、LongAutoIncrement对应number。
   * Date对应Date。

`<pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums">``<li><p>`import { cloudDatabase } from '@kit.CloudFoundationKit';`</p></li>``<li data-node-id="20251224174551-uqyk77u"></li>``<li><p>`class BookInfo extends cloudDatabase.DatabaseObject{`</p></li>``<li data-node-id="20251224174551-tvjqgbh"><p>`  public naturalbase_ClassName(): string {`</p></li>``<li><p>`    return "BookInfo";`</p></li>``<li data-node-id="20251224174551-vk23bnb"><p>`  }`</p></li>``<li><p>`  public id: number | undefined;`</p></li>``<li data-node-id="20251224174551-wzpniqq"><p>`  public bookName: string | undefined;`</p></li>``<li><p>`  public author: string | undefined;`</p></li>``<li data-node-id="20251224174551-eoux7mq"><p>`  public price: number | undefined;`</p></li>``<li><p>`  public borrowerId: number | undefined;`</p></li>``<li data-node-id="20251224174551-2tbrhdu"><p>`  public borrowerName: string | undefined;`</p></li>``<li><p>`  public borrowerTime: Date | undefined;`</p></li>``<li data-node-id="20251224174551-xkcto4m"><p>`}`</p></li>``<li></li>``<li data-node-id="20251224174551-nwqn116"><p>`export { BookInfo };`</p></li>``</ol></pre>`




# 初始化数据库访问

**更新时间: 2025-12-23 19:45**

## 约束与限制

支持Phone、Tablet设备。并且从5.1.0(18)版本开始，新增支持Wearable设备；从5.1.1(19)版本开始，新增支持TV设备。

## 前提条件

已[引入对象类型文件](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-add-file)。

## 操作步骤

1. 设置云数据库配置项。
   在“entry/src/main/module.json5”文件中添加网络权限。

* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>"requestPermissions": [</p></li><li data-node-id="20251224174627-rp8cjf0"><p>  {</p></li><li><p>    "name": "ohos.permission.INTERNET"</p></li><li data-node-id="20251224174627-3b7znj1"><p>  }</p></li><li><p>]</p></li></ol></pre>
* （可选）如果存在需要登录应用才能操作数据库的场景（如新增或删除数据），您需要执行如下操作：

  1. [通过AuthProvider获取用户凭据](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section136610231214)。
  2. 调用[cloudCommon.init()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section15555111210233)方法进行初始化时，传入获取的凭据。
* 在业务代码中，使用AGC开发平台上创建的存储区“QuickStartDemo”类初始化DatabaseZone。
* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>import { cloudDatabase } from '@kit.CloudFoundationKit';</p></li><li data-node-id="20251224174627-3ti8pr1"></li><li><p>let databaseZone = cloudDatabase.zone('QuickStartDemo');</p></li></ol></pre>

  注意

  * cloudDatabase.zone方法接收的入参为“存储区名称”，即cloudDBZoneName，请参见[新增存储区](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-add-zone)章节。
  * 存储区最多创建4个，超过4个会导致云数据库访问失败。
* 如果需要使用数据库查询方法，可以使用类（此处以BookInfo为例）初始化DatabaseQuery。

<pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>import { BookInfo } from 'xx/BookInfo'; // xx是BookInfo文件的相对路径</p></li><li data-node-id="20251224174627-95klm20"></li><li><p>let condition = new cloudDatabase.DatabaseQuery(BookInfo);</p></li></ol></pre>

说明

后续“databaseZone”、“condition”都需要在每个查询中独立使用，可以参考此章节创建，下文代码中不再重复创建的操作。



# 查询数据

**更新时间: 2025-12-23 19:46**

云数据库通过[query()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section390417613213)方法查询对象，并提供了丰富的谓词查询，比如[equalTo()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section9706571488)、[notEqualTo()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section16955165444812)、[in()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section6276103955110)等。通过单个或者多个链式过滤条件，开发者可以从存储区查询到满足特定条件的对象，也可以通过排序谓词对查询结果排序，或者通过限定查询返回数量谓词限定查询结果返回的数量。详细的查询条件请参见[DatabaseQuery](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section76501736191415)。

应用会直接从云侧存储区服务器查询数据，本地不会缓存数据。

说明

* 每次的查询操作仅支持查询一个对象类型下的数据。
* 调用查询数据方法，有两种返回方式，返回一个Promise对象或者在参数中传入一个callback对象返回，下面以Promise为例详细说明。

## 约束与限制

支持Phone、Tablet设备。并且从5.1.0(18)版本开始，新增支持Wearable设备；从5.1.1(19)版本开始，新增支持TV设备。

## 前提条件

已[初始化数据库访问](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-initialize)。

## 简单查询

开发者可以在无查询条件时，获取一个对象类型中所有的对象；也可以指定单个查询条件，来获取满足该条件的对象。

* 查询对象类型BookInfo的所有数据。
* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>import { hilog } from '@kit.PerformanceAnalysisKit';</p></li><li data-node-id="20251224174649-ahmi3wx"></li><li><p>async queryAll() {</p></li><li data-node-id="20251224174649-h5ny2n7"><p>  try {</p></li><li><p>    let resultArray = await databaseZone.query(condition);</p></li><li data-node-id="20251224174649-aiwq2nf"><p>    hilog.info(0x0000, 'testTag', `Succeeded in querying data, result: ${JSON.stringify(resultArray)}`);</p></li><li><p>  } catch (err) {</p></li><li data-node-id="20251224174649-keubm9l"><p>    hilog.error(0x0000, 'testTag', `Failed to query data, code: ${err.code}, message: ${err.message}`);</p></li><li><p>  }</p></li><li data-node-id="20251224174649-ao14xne"><p>}</p></li></ol></pre>

  说明

  后续hilog都需要从@kit.PerformanceAnalysisKit中引入，将不在示例代码中呈现。
* 通过异步侦听的方式查询“bookName”参数对应的书籍。
* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>async queryBook(bookName: string): Promise<BookInfo> {</p></li><li data-node-id="20251224174649-8w7qoi4"><p>  try {</p></li><li><p>    condition.equalTo('bookName', bookName);</p></li><li data-node-id="20251224174649-zvblzo6"><p>    let resultArray = await databaseZone.query(condition);</p></li><li><p>    let bookInfo = resultArray[0];</p></li><li data-node-id="20251224174649-x33saav"><p>    hilog.info(0x0000, 'testTag', `Succeeded in querying data, result: ${JSON.stringify(resultArray)}`);</p></li><li><p>    return Promise.resolve(bookInfo);</p></li><li data-node-id="20251224174649-fum43p3"><p>  } catch (err) {</p></li><li><p>    hilog.error(0x0000, 'testTag', `Failed to query data, code: ${err.code}, message: ${err.message}`);</p></li><li data-node-id="20251224174649-1d8efdb"><p>    return Promise.reject(err);</p></li><li><p>  }</p></li><li data-node-id="20251224174649-ic17pa5"><p>}</p></li></ol></pre>

## 复合查询

开发者可以通过多个链式过滤条件，来获取满足条件的对象。多个链式条件之间默认用“与”运算。

* 构造查询条件，并调用[query()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section390417613213)方法，查询“bookName”包含“数据库”，“price”大于20.0并且小于50.0的书籍。
* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>condition.contains('bookName', '数据库')</p></li><li data-node-id="20251224174649-fx01z86"><p>  .greaterThan('price', 20.0)</p></li><li><p>  .and()</p></li><li data-node-id="20251224174649-goup0i8"><p>  .lessThan('price', 50.0);</p></li><li><p>let resultArray = await databaseZone.query(condition);</p></li></ol></pre>
* 构造查询条件，并调用[query()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section390417613213)方法，查询“bookName”包含“数据库”，“price”在小于20.0或者大于50.0区间的书籍。
* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>condition.contains('bookName', '数据库')</p></li><li data-node-id="20251224174649-z27l5eg"><p>  .lessThan('price', 20.0)</p></li><li><p>  .or()</p></li><li data-node-id="20251224174649-g80pezb"><p>  .greaterThan('price', 50.0);</p></li><li><p>let resultArray = await databaseZone.query(condition);</p></li></ol></pre>
* 构造查询条件，并调用[query()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section390417613213)方法，查询“bookName”包含“史记”，“author”是“司马迁”，“price”大于60.0的书籍。
* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>condition.contains('bookName', '史记')</p></li><li data-node-id="20251224174649-wdtmify"><p>  .equalTo('author', '司马迁')</p></li><li><p>  .greaterThan('price', 60.0);</p></li><li data-node-id="20251224174649-1v4qf92"><p>let resultArray = await databaseZone.query(condition);</p></li></ol></pre>
* 构造查询条件，并调用[query()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section390417613213)方法，查询“bookName”包含“自传”，并且“author”是“齐白石”，或者“author”是“司马迁”，并且“price”大于60.0的书籍。
* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>condition.contains('bookName', '自传')</p></li><li data-node-id="20251224174649-rbx7cv0"><p>  .beginGroup()</p></li><li><p>  .equalTo('author', '齐白石')</p></li><li data-node-id="20251224174649-dneg9xf"><p>  .or()</p></li><li><p>  .equalTo('author', '司马迁')</p></li><li data-node-id="20251224174649-gxsniqz"><p>  .endGroup()</p></li><li><p>  .greaterThan('price', 60.0);</p></li><li data-node-id="20251224174649-rc5rz14"><p>let resultArray = await databaseZone.query(condition);</p></li></ol></pre>

## 数据排序

开发者可以通过[orderByAsc()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section0344144315513)或者[orderByDesc()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section1754544435111)实现对查询结果集中的对象按某个字段进行升序或者降序排列，排序谓词需要在其它查询谓词之后且在限定数据查询数量谓词之前。

<pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>condition.lessThan('price', 50.0)</p></li><li data-node-id="20251224174649-pc5qqx2"><p>  .orderByDesc('price');</p></li><li><p>let resultArray = await databaseZone.query(condition);</p></li></ol></pre>

## 随机查询

从6.0.1(21)版本开始，新增支持随机查询功能。

开发者可以通过[orderByRandom()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section19149641220)按随机顺序展示查询结果集中的对象。

该方法适用于推荐随机内容、播放随机音视频等场景。

<pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>condition.orderByRandom()</p></li><li data-node-id="20251224174649-rvdedx3"><p>  .limit(10);</p></li><li><p>let resultArray = await databaseZone.query(condition);</p></li></ol></pre>

## 限定数据查询返回数量

在查询数据时，开发者可以通过[limit()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section9232724175819)限定查询返回数据的起始位置和数量，实现数据的分页。例如与排序查询谓词组合使用，可以实现获取top-N条数据。

对查询结果中的对象限定查询返回数量时，限定数据查询返回数量谓词在所有其他谓词查询之后。

* 构造查询条件，并调用[query()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section390417613213)方法，查询所有价格小于50.0的书籍，并且只显示最开始10条记录。
* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>condition.lessThan('price', 50.0)</p></li><li data-node-id="20251224174649-hzvhpky"><p>  .limit(10);</p></li><li><p>let resultArray = await databaseZone.query(condition);</p></li></ol></pre>
* 构造查询条件，并调用[query()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section390417613213)方法，查询所有价格小于50.0的书籍，并将查询结果按照降序排序，只显示价格排序从第6条开始的10条记录。
* <pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>condition.lessThan('price', 50.0)</p></li><li data-node-id="20251224174649-8qaz0v4"><p>  .orderByDesc('price')</p></li><li><p>  .limit(10, 6);</p></li><li data-node-id="20251224174649-2vrh2gb"><p>let resultArray = await databaseZone.query(condition);</p></li></ol></pre>

## 对查询结果进行算术计算

在查询数据时，可以通过[calculateQuery()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section1248132432017)对查询结果对象中的某个字段进行算术计算并返回计算的结果。

构造查询条件，并调用[calculateQuery()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section1248132432017)方法，查询所有价格小于50.0的书籍，并且计算所有书籍价格的平均值。

<pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>async calculateQuery() {</p></li><li data-node-id="20251224174649-myx6m78"><p>  try {</p></li><li><p>    condition.lessThan('price', 50.0);</p></li><li data-node-id="20251224174649-jpehru0"><p>    let resultNum = await databaseZone.calculateQuery(condition, 'price', cloudDatabase.QueryCalculate.AVERAGE);</p></li><li><p>    hilog.info(0x0000, 'testTag', `Succeeded in calculating queried data, result: ${JSON.stringify(resultNum)}`);</p></li><li data-node-id="20251224174649-7wszzob"><p>  } catch (err) {</p></li><li><p>    hilog.error(0x0000, 'testTag', `Failed to calculate queried data, code: ${err.code}, message: ${err.message}`);</p></li><li data-node-id="20251224174649-ra37ipi"><p>  }</p></li><li><p>}</p></li></ol></pre>



# 写入数据

**更新时间: 2025-12-23 19:46**

开发者可以通过[upsert()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section686153211276)将一个或者一组对象写入到当前存储区中。在写入对象时，如果在存储区已经存在主键相同的对象，则更新已有的对象；如果不存在，则写入一个新的对象。写入的数据可以来自于新建对象，或者从存储区查询出来的对象。

写入一组对象时，数据的写入操作是原子性的，即对象列表中的对象要么全部成功写入，要么全部失败。

说明

* 写入一组对象时，该组中的对象必须属于同一个对象类型，否则会导致写入失败。
* 写入一组对象时，数据总大小不能超过2MB，否则会导致写入失败。
* 写入一组对象时，数据总条数不能超过1000条，否则会导致写入失败。
* 调用写入数据方法，有两种返回方式，返回一个Promise对象或者在参数中传入一个callback对象返回，下面以Promise为例详细说明。

## 约束与限制

支持Phone、Tablet设备。并且从5.1.0(18)版本开始，新增支持Wearable设备；从5.1.1(19)版本开始，新增支持TV设备。

## 前提条件

已[初始化数据库访问](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-initialize)。

## 写入数据

Promise对象中封装了写入操作执行的结果，通过该Promise对象可以异步侦听执行结果：如果执行成功，可以获取写入的对象数量；如果执行失败，可以获取错误信息。

**代码示例：**

将BookInfo对象写入至存储区中，写入成功后，返回写入的数量；写入失败，抛出异常。



`<pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums">``<li><p>`// 更新”西游记”的借阅者信息 `</p></li>``<li data-node-id="20251224174707-jybfpbu"><p>`async upsert() {`</p></li>``<li><p>`  try {`</p></li>``<li data-node-id="20251224174707-dfb4dqu"><p>`    let book = await this.queryBook('西游记'); // 查询出”西游记”的书籍信息 `</p></li>``<li><p>`    book.borrowerId = 1;`</p></li>``<li data-node-id="20251224174707-77zerrx"><p>`    book.borrowerName = '小明';`</p></li>``<li><p>`    book.borrowerTime = new Date();`</p></li>``<li data-node-id="20251224174707-fusjtzm"><p>`    let record = await databaseZone.upsert(book);`</p></li>``<li><p>`    hilog.info(0x0000, 'testTag', `Succeeded in upserting a book, result: ${JSON.stringify(record)}`);`</p></li>``<li data-node-id="20251224174707-dsgthxz"><p>`  } catch (err) {`</p></li>``<li><p>`    hilog.error(0x0000, 'testTag', `Failed to upsert a book, code: ${err.code}, message: ${err.message}`);`</p></li>``<li data-node-id="20251224174707-as73ei5"><p>`  }`</p></li>``</ol></pre>`





# 删除数据

**更新时间: 2025-12-23 19:46**

开发者可以通过[delete()](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section1630522892714)删除单个对象或者一组对象。删除数据时，云数据库会根据传入对象主键删除相应的数据，不会比对该对象其它属性与存储的数据是否一致。删除一组对象时，删除操作是原子性的，即对象列表中的对象要么全部删除成功，要么全部删除失败。

说明

* 删除一组对象时，该组中的对象必须属于同一个对象类型，否则会导致删除失败。
* 调用删除数据方法，有两种返回方式，返回一个Promise对象或者在参数中传入一个callback对象返回，本文以Promise为例详细说明。

## 约束与限制

支持Phone、Tablet设备。并且从5.1.0(18)版本开始，新增支持Wearable设备；从5.1.1(19)版本开始，新增支持TV设备。

## 前提条件

已[初始化数据库访问](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-initialize)。

## 删除数据

**代码示例：**

将对象删除，如果删除成功，返回删除对象的个数；执行失败，抛出异常。

<pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><p>// 假设图书遗失，图书管理员需要将遗失的书籍从BookInfo表里删除</p></li><li data-node-id="20251224174727-msog8rb"><p>async delete() {</p></li><li><p>  try {</p></li><li data-node-id="20251224174727-6yv1hfx"><p>    let book = new BookInfo(); </p></li><li><p>    book.id = 3;</p></li><li data-node-id="20251224174727-p36bh0c"><p>    let deleteNum = await databaseZone.delete(book);</p></li><li><p>    hilog.info(0x0000, 'testTag', `Succeeded in deleting data, result: ${JSON.stringify(deleteNum)}`);</p></li><li data-node-id="20251224174727-qudr7ti"><p>  } catch (err) {</p></li><li><p>    hilog.error(0x0000, 'testTag', `Failed to delete data, code: ${err.code}, message: ${err.message}`);</p></li><li data-node-id="20251224174727-a9xe5ju"><p>  }</p></li><li><p>}</p></li></ol></pre>
